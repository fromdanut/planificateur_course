<?php

namespace PC\PlatformBundle\Repository;

/**
 * RecipeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RecipeRepository extends \Doctrine\ORM\EntityRepository
{
    public function findAllWithImage()
    {
      $qb = $this
        ->createQueryBuilder('r')
        ->leftJoin('r.image', 'image')
        ->addSelect('image')
      ;

      return $qb
        ->getQuery()
        ->getResult()
      ;
    }

    public function findByShoppingListOption($shoppingListOption)
    {
        $qb = $this->createQueryBuilder('r');

        /*
            rajoute des conditions en fonction des paramÃ¨tres (tous des bool)
            Les valeurs des conditions where devront faire l'objet d'une autre
            configuration de l'utilisateur.
        */
        if ($shoppingListOption->getQuick()) {
            $qb->where('r.cookingTime < 20');
        }

        if ($shoppingListOption->getEco()) {
            $qb->andWhere('r.price < 10');
        }

        if ($shoppingListOption->getDiet()) {
            $qb->andWhere('r.calorie < 15000');
        }

        return $qb
          ->getQuery()
          ->getResult()
        ;
    }
}
